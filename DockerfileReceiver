# Use Eclipse Temurin JDK to build the application and create custom JRE
FROM eclipse-temurin:21 as builder

# Set the working directory in the container
WORKDIR /app

# Copy the parent POM and the ChildA POM into the Docker image
COPY ./pom.xml /app
COPY ./receiver/pom.xml /app/receiver/

# Copy the Maven wrapper and configuration files from ChildA
COPY ./receiver/mvnw /app/receiver/
COPY ./receiver/.mvn /app/receiver/.mvn

# Ensure the Maven wrapper script is executable
RUN chmod +x /app/receiver/mvnw

# Copy the application source code from ChildA
COPY ./receiver/src /app/receiver/src

# Build the application
RUN cd /app/receiver && ./mvnw clean package

# Expose port 8080 (or whichever port your application uses)
EXPOSE 9090

# Run the application
CMD ["java", "-jar", "/app/receiver/target/receiver-0.0.1-SNAPSHOT.jar"]